var TimerUpdater={_timersToUpdate:[],_interval:null,start:function(){clearInterval(TimerUpdater._interval);TimerUpdater._interval=setInterval(TimerUpdater._update,1000);TimerUpdater._update()},_update:function(){for(var a in TimerUpdater._timersToUpdate){var d=TimerUpdater._timersToUpdate[a];var c=$(".timer#"+d);TimerUpdater.setElapsed(c,TimerUpdater.getElapsed(c)+1)}var b=0;$(".timer").each(function(){b+=TimerUpdater.getElapsed($(this))});$("#total-elapsed").html(b)},getElapsed:function(a){return parseInt(a.find(".elapsed").text())},setElapsed:function(b,a){b.find(".elapsed").html(a)},register:function(b){var a=_.indexOf(TimerUpdater._timersToUpdate,b.attr("id"));if(a<0){TimerUpdater._timersToUpdate.push(b.attr("id"))}},unregister:function(b){var a=_.indexOf(TimerUpdater._timersToUpdate,b.attr("id"));if(a>=0){TimerUpdater._timersToUpdate=_.without(TimerUpdater._timersToUpdate,b.attr("id"))}}};$(document).ready(function(){var a=function(c){if(c.is(".stopped")){$.post(ROUTES.startTimer,{id:c.attr("id"),_token:SESSION_TOKEN},function(d){if(d){c.removeClass("stopped");c.addClass("running");c.find(".controller").html("Stop");TimerUpdater.register(c)}})}else{$.post(ROUTES.stopTimer,{id:c.attr("id"),_token:SESSION_TOKEN},function(d){if(d.result){c.removeClass("running");c.addClass("stopped");c.find(".controller").html("Start");TimerUpdater.unregister(c);TimerUpdater.setElapsed(c,d.elapsed)}})}};var b=function(c){if(c.is(".running")){TimerUpdater.register(c)}};$("a.controller").click(function(){a($(this).parent().parent());return false});$(".timer").each(function(){b($(this))});TimerUpdater.start()});